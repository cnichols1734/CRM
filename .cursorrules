# CRM Project - Cursor AI Rules

## Project Overview
This is a Flask-based CRM application for Origen Realty real estate agents.
- **Framework**: Flask with SQLAlchemy
- **Database**: Supabase PostgreSQL (connection string in `.env`)
- **Hosting**: PythonAnywhere (www.origentechnolog.com)
- **Repo**: https://github.com/cnichols1734/CRM

## Local Development
- **Port**: 5011
- **Start command**: `python3 app.py` (from project root)
- **Local URL**: http://127.0.0.1:5011

## Testing Rules
Never auto test UI tests unless I specifically ask for it  
- Once a feature is complete ask me if I am ready to push a PR for it before pushing it

## Testing Credentials
Test credentials are stored in the `.env` file:
- `TEST_USERNAME` - email for login
- `TEST_PASSWORD` - password for login

When testing features locally, read the `.env` file to get these credentials, then use the browser tools to:
1. Navigate to http://127.0.0.1:5011
2. Login with the test credentials
3. Test the feature

## AI Features
All AI features use a centralized service with GPT-5.1 fallback chain:
- **Service file**: `services/ai_service.py`
- **Model hierarchy**: GPT-5.1 → GPT-5-mini → GPT-4o

AI feature routes (each has its own custom prompt):
- `routes/action_plan.py` - 2026 Lead Generation Action Plan
- `routes/daily_todo.py` - AI-generated daily task list
- `routes/ai_chat.py` - B.O.B. (Business Optimization Buddy) chat assistant

## Deployment Workflow
After pushing changes to GitHub:
1. SSH into PythonAnywhere or use Bash console
2. Run: `cd ~/mysite && git pull origin main`
3. If new packages: `pip install -r requirements.txt --user`
4. Go to Web tab and click "Reload"

## Key Files
- `app.py` - Main Flask application
- `models.py` - SQLAlchemy database models
- `config.py` - Configuration (reads from .env)
- `feature_flags.py` - Feature toggles (deploys with code via git)
- `.env` - Environment variables (gitignored, contains secrets)
- `services/` - Shared services (AI, SendGrid)
- `routes/` - Flask blueprints/routes
- `templates/` - Jinja2 HTML templates
- `static/` - CSS, JS, images

## Feature Flags
Toggle features on/off in `feature_flags.py`. Changes deploy with git pull - no need to edit .env on server.

Current flags:
- `SHOW_DASHBOARD_JOKE` - Dashboard joke of the day (fetches from external APIs)

## Database
- **Production**: Supabase PostgreSQL
- **Local test DB**: `instance/crm.db` (SQLite, for quick testing only)
- **Production data backup**: `instance/crm (1).db`

## PR & Commit Rules
Always use the PR workflow - commit changes to a branch and push for review in GitHub.

### Branch & Commit Naming Convention
Use conventional commit prefixes for branches and commit messages:

| Prefix | Use For |
|--------|---------|
| `feat:` | New features (e.g., `feat: add contact import wizard`) |
| `fix:` | Bug fixes (e.g., `fix: resolve login redirect loop`) |
| `chore:` | Maintenance, dependencies, configs (e.g., `chore: update requirements.txt`) |
| `refactor:` | Code restructuring without behavior change (e.g., `refactor: extract base.html inline JS`) |
| `docs:` | Documentation only (e.g., `docs: update README with deploy steps`) |
| `style:` | Formatting, CSS, no logic change (e.g., `style: fix button alignment on mobile`) |
| `test:` | Adding or updating tests (e.g., `test: add scheduled integration tests`) |
| `perf:` | Performance improvements (e.g., `perf: optimize contact list query`) |

### Branch Naming
Use the same prefix with kebab-case description:
- `feat/contact-import-wizard`
- `fix/login-redirect-loop`
- `chore/update-dependencies`
- `refactor/base-js`

### PR Workflow
**IMPORTANT: Before starting ANY new feature or fix:**
1. Ensure you are on `main` branch
2. Run `git pull origin main` to sync with remote
3. Only then create the feature branch and begin work

**Steps:**
1. Sync with main: `git checkout main && git pull origin main`
2. Create feature branch with appropriate prefix
3. Make commits with conventional prefixes
4. Push branch to origin
5. User reviews and creates PR via GitHub UI (one-click merge)

## Important Notes
- The `.env` file is gitignored - never commit secrets
- PythonAnywhere has its own `.env` file at `~/mysite/.env`
