# =============================================================================
# HOA ADDENDUM - DocuSeal Field Mapping
# =============================================================================
# This file maps CRM form fields to DocuSeal template fields.
#
# Template ID: 2469165
# DocuSeal Template URL: https://docuseal.com/d/b3S4Ryi2HCjoh4
#
# Document: Addendum for Property Subject to Mandatory Membership in
#           Owners' Association (TREC Form)
#
# Submitters (signers):
#   - Seller (primary seller) - has all pre-filled fields + signature
#   - Seller 2 (co-seller, optional) - only signature fields, omit if no 2nd seller
#
# ACTUAL DOCUSEAL FIELDS (as of 2026-01-04):
#   Seller role:
#     - Street address (text)
#     - Association name & phone (text)
#     - 1. Days after effective date (number) - for Option 1
#     - 2. Days after effective date (number) - for Option 2
#     - Seller signature 1 (signature)
#     - Signature date 1 (date)
#     - Option 1, Option 2, Option 3, Option 4 (text) - use "X" for selected
#     - Buyer does, Buyer does not (text) - resale cert checkboxes, use "X"
#     - C. Buyer paid transfer fee (number)
#     - D. Buyer pays (text) - two fields for section D
#
#   Seller 2 role:
#     - Signature Field 2 (signature)
#     - Signature date 2 (date)
#
# HOW TO UPDATE:
#   1. View fields at: /transactions/admin/docuseal/template/2469165
#   2. Match your CRM form field to the DocuSeal field name
#   3. Run a test submission to verify
# =============================================================================

template_id: 2469165
template_name: "HOA Addendum"
template_slug: "hoa-addendum"

# What roles does this template use?
# Seller 2 is optional - only include in submission if there's a 2nd seller
submitter_roles:
  - Seller
  - Seller 2

# =============================================================================
# FIELD MAPPINGS - SELLER FIELDS
# Format: crm_field: docuseal_field
# These fields go to the Seller submitter (all pre-filled, read-only except signatures)
# 
# Form field names come from hoa_addendum_fields.html
# =============================================================================
field_mappings:

  # Section C - Fees and Deposits (form uses buyer_fee_cap)
  buyer_fee_cap: "C. Buyer paid transfer fee"


# =============================================================================
# CONDITIONAL FIELD MAPPINGS
# These fields are only sent if a condition is met
# Format: condition_field -> { condition_value -> { form_field: docuseal_field } }
# =============================================================================
conditional_fields:
  # Days fields depend on which option is selected
  doc_responsibility:
    seller:
      seller_delivery_days: "1. Days after effective date"
    buyer:
      buyer_delivery_days: "2. Days after effective date"


# =============================================================================
# COMPUTED OPTION FIELDS
# The form uses doc_responsibility radio with values: seller, buyer, already_received, not_required
# These map to DocuSeal Options 1-4. Also handles require_updated_resale and additional_doc_fee_paid_by.
# These are computed in build_docuseal_fields based on form values.
# =============================================================================
option_transforms:
  # doc_responsibility value -> which Option gets X
  doc_responsibility:
    seller: "Option 1"           # Seller delivers docs
    buyer: "Option 2"            # Buyer delivers docs
    already_received: "Option 3" # Buyer already has docs
    not_required: "Option 4"     # Buyer doesn't need docs
  
  # For Option 3 (already_received), require_updated_resale determines:
  require_updated_resale:
    "yes": "Buyer does"          # Buyer requires updated resale cert
    "no": "Buyer does not"       # Buyer does not require
  
  # additional_doc_fee_paid_by determines section D
  additional_doc_fee_paid_by:
    buyer: "D. Buyer pays"
    seller: "D. Seller pays"


# =============================================================================
# SELLER 2 FIELDS
# These fields go to the Seller 2 submitter (second seller)
# Note: Signature and date are handled automatically by DocuSeal
# =============================================================================
seller_2_fields: {}
  # Seller 2 only has signature fields which are handled by DocuSeal
  # No pre-filled fields needed


# =============================================================================
# VALUE TRANSFORMS
# These fields require value transformation before sending to DocuSeal
# =============================================================================
transforms:

  # Currency fields - will have commas/$ stripped
  currency_fields:
    - buyer_fee_cap

  # Date fields - will be converted to MM/DD/YYYY
  date_fields: []


# =============================================================================
# BROKER/AGENT FIELDS
# Note: This template doesn't have Broker role - agent data not auto-populated
# =============================================================================
agent_fields: []


# =============================================================================
# COMPUTED FIELDS
# Fields that combine or transform multiple form values
# =============================================================================
computed_fields:
  # Combine HOA name and phone for the single field in DocuSeal
  - docuseal_field: "Association name & phone"
    template: "{hoa_name} - {hoa_phone}"
  
  # Combine address fields for Street address
  - docuseal_field: "Street address"
    template: "{property_address}, {property_city}, {property_state} {property_zip}"
