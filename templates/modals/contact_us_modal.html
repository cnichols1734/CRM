<!-- Contact Us Modal -->
<div id="contactUsModal" class="fixed inset-0 bg-black/50 backdrop-blur-sm z-[9999] hidden opacity-0 transition-opacity duration-300">
    <div class="min-h-screen px-4 flex items-center justify-center">
        <div class="relative bg-white rounded-3xl shadow-2xl w-full max-w-2xl transform transition-all duration-300 scale-95" id="contactUsModalContent">
            <!-- Close Button -->
            <button onclick="closeContactUsModal()" class="absolute -top-3 -right-3 w-10 h-10 bg-white hover:bg-gray-50 text-gray-400 hover:text-gray-600 rounded-full shadow-lg flex items-center justify-center transition-all group z-10">
                <i class="fas fa-times text-lg group-hover:rotate-90 transition-transform duration-300"></i>
            </button>
            
            <!-- Header -->
            <div class="px-8 pt-8 pb-6 border-b border-gray-100">
                <div class="flex items-center justify-center mb-4">
                    <div class="w-14 h-14 bg-gradient-to-br from-accent-500 to-accent-600 rounded-2xl flex items-center justify-center shadow-lg shadow-accent-500/20">
                        <i class="fas fa-comment-dots text-white text-2xl"></i>
                    </div>
                </div>
                <h2 class="text-3xl font-bold text-brand-900 text-center mb-2">How can we help you?</h2>
                <p class="text-brand-600 text-center">Have a question, suggestion, or need assistance? We'd love to hear from you.</p>
            </div>
            
            <!-- Form -->
            <form id="contactUsForm" class="px-8 py-6">
                <!-- Subject Field -->
                <div class="mb-5">
                    <label for="contactSubject" class="block text-sm font-semibold text-brand-700 mb-2">
                        What's this about?
                    </label>
                    <input 
                        type="text" 
                        id="contactSubject" 
                        name="subject"
                        class="w-full px-4 py-3 bg-gray-50 border border-gray-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-accent-500 focus:border-transparent transition-all text-brand-900 placeholder-gray-400"
                        placeholder="Brief summary of your inquiry"
                        required
                    >
                </div>
                
                <!-- Message Field -->
                <div class="mb-5">
                    <label for="contactMessage" class="block text-sm font-semibold text-brand-700 mb-2">
                        Tell us more
                    </label>
                    <textarea 
                        id="contactMessage" 
                        name="message"
                        rows="6"
                        class="w-full px-4 py-3 bg-gray-50 border border-gray-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-accent-500 focus:border-transparent transition-all text-brand-900 placeholder-gray-400 resize-none"
                        placeholder="Provide details about your question or feedback..."
                        required
                    ></textarea>
                    <p class="mt-2 text-xs text-gray-500">The more details you provide, the better we can help you.</p>
                </div>
                
                <!-- Email Field (pre-filled if logged in) -->
                <div class="mb-6">
                    <label for="contactEmail" class="block text-sm font-semibold text-brand-700 mb-2">
                        We'll reply to
                    </label>
                    <div class="relative">
                        <input 
                            type="email" 
                            id="contactEmail" 
                            name="email"
                            class="w-full px-4 py-3 bg-gray-50 border border-gray-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-accent-500 focus:border-transparent transition-all text-brand-900 placeholder-gray-400"
                            placeholder="your@email.com"
                            value="{{ current_user.email if current_user.is_authenticated else '' }}"
                            required
                        >
                        {% if current_user.is_authenticated %}
                        <div class="absolute right-3 top-1/2 -translate-y-1/2">
                            <i class="fas fa-check text-green-500 text-sm"></i>
                        </div>
                        {% endif %}
                    </div>
                </div>
                
                <!-- Submit Button -->
                <button 
                    type="submit"
                    class="w-full px-6 py-3.5 bg-gradient-to-r from-accent-500 to-accent-600 text-white font-semibold rounded-xl hover:from-accent-600 hover:to-accent-700 transition-all duration-200 shadow-lg shadow-accent-500/30 hover:shadow-xl hover:shadow-accent-500/40 flex items-center justify-center gap-2 group"
                    id="contactSubmitBtn"
                >
                    <i class="fas fa-paper-plane group-hover:translate-x-0.5 transition-transform"></i>
                    Send Message
                </button>
            </form>
            
            <!-- Footer -->
            <div class="px-8 pb-6 pt-2">
                <p class="text-xs text-gray-500 text-center">
                    Need immediate assistance? Check out our <a href="#" class="text-accent-600 hover:text-accent-700 font-medium">help center</a> for answers to common questions.
                </p>
            </div>
        </div>
    </div>
</div>

<script>
// Different placeholder configurations
const CONTACT_PLACEHOLDERS = {
    landing: {
        subject: "Questions about pricing, features, or getting started?",
        message: "Tell us what you'd like to know about Origen TechnolOG CRM. Ask about features, pricing plans, signing up, or schedule a demo..."
    },
    app: {
        subject: "Brief summary of your inquiry",
        message: "Describe your issue, feedback, or question in detail. Include any relevant information that will help us assist you better..."
    }
};

function openContactUsModal(context = 'app') {
    const modal = document.getElementById('contactUsModal');
    const modalContent = document.getElementById('contactUsModalContent');
    const subjectInput = document.getElementById('contactSubject');
    const messageInput = document.getElementById('contactMessage');
    
    // Set placeholders based on context
    const placeholders = CONTACT_PLACEHOLDERS[context] || CONTACT_PLACEHOLDERS.app;
    subjectInput.placeholder = placeholders.subject;
    messageInput.placeholder = placeholders.message;
    
    modal.classList.remove('hidden');
    
    // Trigger animation
    requestAnimationFrame(() => {
        modal.classList.remove('opacity-0');
        modalContent.classList.remove('scale-95');
        modalContent.classList.add('scale-100');
    });
    
    // Prevent body scroll
    document.body.style.overflow = 'hidden';
}

function closeContactUsModal() {
    const modal = document.getElementById('contactUsModal');
    const modalContent = document.getElementById('contactUsModalContent');
    
    modal.classList.add('opacity-0');
    modalContent.classList.remove('scale-100');
    modalContent.classList.add('scale-95');
    
    setTimeout(() => {
        modal.classList.add('hidden');
        document.body.style.overflow = '';
        // Reset form
        document.getElementById('contactUsForm').reset();
    }, 300);
}

// Close on escape key
document.addEventListener('keydown', function(e) {
    if (e.key === 'Escape') {
        const modal = document.getElementById('contactUsModal');
        if (!modal.classList.contains('hidden')) {
            closeContactUsModal();
        }
    }
});

// Close on background click
document.getElementById('contactUsModal')?.addEventListener('click', function(e) {
    if (e.target === this) {
        closeContactUsModal();
    }
});

// Handle form submission
document.getElementById('contactUsForm')?.addEventListener('submit', async function(e) {
    e.preventDefault();
    
    const submitBtn = document.getElementById('contactSubmitBtn');
    const originalText = submitBtn.innerHTML;
    
    // Show loading state
    submitBtn.disabled = true;
    submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Sending...';
    
    const formData = new FormData(this);
    const data = {
        subject: formData.get('subject'),
        message: formData.get('message'),
        email: formData.get('email')
    };
    
    try {
        const response = await fetch('/contact-us', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify(data)
        });
        
        const result = await response.json();
        
        if (response.ok) {
            // Success state
            submitBtn.innerHTML = '<i class="fas fa-check"></i> Message Sent!';
            submitBtn.classList.remove('from-accent-500', 'to-accent-600', 'hover:from-accent-600', 'hover:to-accent-700');
            submitBtn.classList.add('from-green-600', 'to-green-700');
            
            // Show success toast if available
            if (typeof showToast !== 'undefined') {
                showToast('Message sent successfully! We\'ll get back to you soon.', 'success');
            }
            
            // Close modal after short delay
            setTimeout(() => {
                closeContactUsModal();
                submitBtn.disabled = false;
                submitBtn.innerHTML = originalText;
                submitBtn.classList.remove('from-green-600', 'to-green-700');
                submitBtn.classList.add('from-accent-500', 'to-accent-600', 'hover:from-accent-600', 'hover:to-accent-700');
            }, 1500);
        } else {
            // Show the actual error message from the server
            const errorMsg = result.message || 'Failed to send message';
            submitBtn.disabled = false;
            submitBtn.innerHTML = originalText;
            
            if (typeof showToast !== 'undefined') {
                showToast(errorMsg, 'error');
            } else {
                alert(errorMsg);
            }
        }
    } catch (error) {
        console.error('Error sending message:', error);
        
        // Error state
        submitBtn.disabled = false;
        submitBtn.innerHTML = originalText;
        
        // Show error toast if available
        if (typeof showToast !== 'undefined') {
            showToast('Failed to send message. Please try again.', 'error');
        } else {
            alert('Failed to send message. Please try again.');
        }
    }
});
</script>
