<!-- Dashboard Page Onboarding Overlay -->
<div id="dashboardOnboarding" class="hidden fixed inset-0 z-[100]">
    <!-- Backdrop - darker gray overlay -->
    <div class="absolute inset-0 bg-black/60 transition-opacity"></div>
    
    <!-- Spotlight on Contacts Link (positioned absolutely) -->
    <div id="contactsLinkSpotlight" class="absolute rounded-lg ring-4 ring-orange-400 shadow-2xl" style="transition: all 0.3s ease; z-index: 101;"></div>
    
    <!-- Onboarding Card -->
    <div class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-11/12 max-w-lg" style="z-index: 102;">
        <div class="bg-white rounded-2xl shadow-2xl overflow-hidden animate-fade-in-up">
            <!-- Header -->
            <div class="bg-gradient-to-r from-orange-500 to-orange-600 px-6 py-5 text-white">
                <div class="flex items-center gap-3 mb-2">
                    <div class="w-10 h-10 bg-white/20 rounded-xl flex items-center justify-center">
                        <i class="fas fa-chart-line text-2xl"></i>
                    </div>
                    <div>
                        <h3 class="text-xl font-bold">Welcome to Your Dashboard!</h3>
                        <p class="text-orange-100 text-sm">Your command center</p>
                    </div>
                </div>
            </div>
            
            <!-- Content -->
            <div class="p-6">
                <div class="space-y-4">
                    <!-- Intro -->
                    <div class="flex gap-4 pb-4 border-b border-slate-200">
                        <div class="flex-1">
                            <p class="text-slate-600 leading-relaxed">
                                Your dashboard gives you a real-time view of your business performance. As you add contacts and update your activities, this dashboard will automatically populate with valuable insights!
                            </p>
                        </div>
                    </div>
                    
                    <!-- Feature 1 -->
                    <div class="flex gap-4">
                        <div class="flex-shrink-0">
                            <div class="w-8 h-8 rounded-full bg-orange-100 text-orange-600 flex items-center justify-center font-bold text-sm">
                                <i class="fas fa-chart-bar text-sm"></i>
                            </div>
                        </div>
                        <div class="flex-1">
                            <h4 class="font-semibold text-slate-900 mb-1">Key Metrics</h4>
                            <p class="text-sm text-slate-600">
                                Track your <span class="font-semibold">Total Potential Commission</span>, <span class="font-semibold">Total Contacts</span>, and <span class="font-semibold">Average Commission</span> at a glance.
                            </p>
                        </div>
                    </div>
                    
                    <!-- Feature 2 -->
                    <div class="flex gap-4">
                        <div class="flex-shrink-0">
                            <div class="w-8 h-8 rounded-full bg-emerald-100 text-emerald-600 flex items-center justify-center font-bold text-sm">
                                <i class="fas fa-hand-holding-usd text-sm"></i>
                            </div>
                        </div>
                        <div class="flex-1">
                            <h4 class="font-semibold text-slate-900 mb-1">Transaction Pipeline</h4>
                            <p class="text-sm text-slate-600">
                                View your deals in motion with our kanban-style board showing <span class="font-semibold">Preparing, Active, Under Contract,</span> and <span class="font-semibold">Closed</span> transactions.
                            </p>
                        </div>
                    </div>
                    
                    <!-- Feature 3 -->
                    <div class="flex gap-4">
                        <div class="flex-shrink-0">
                            <div class="w-8 h-8 rounded-full bg-blue-100 text-blue-600 flex items-center justify-center font-bold text-sm">
                                <i class="fas fa-tasks text-sm"></i>
                            </div>
                        </div>
                        <div class="flex-1">
                            <h4 class="font-semibold text-slate-900 mb-1">Tasks & To-Do's</h4>
                            <p class="text-sm text-slate-600">
                                Stay on top of your <span class="font-semibold">Upcoming Client Tasks</span> and manage your <span class="font-semibold">Personal To-Do List</span>.
                            </p>
                        </div>
                    </div>
                    
                    <!-- Feature 4 -->
                    <div class="flex gap-4">
                        <div class="flex-shrink-0">
                            <div class="w-8 h-8 rounded-full bg-purple-100 text-purple-600 flex items-center justify-center font-bold text-sm">
                                <i class="fas fa-pie-chart text-sm"></i>
                            </div>
                        </div>
                        <div class="flex-1">
                            <h4 class="font-semibold text-slate-900 mb-1">Analytics & Insights</h4>
                            <p class="text-sm text-slate-600">
                                See your <span class="font-semibold">Contact Group Distribution</span> and <span class="font-semibold">Top Contacts by Commission</span> to identify opportunities.
                            </p>
                        </div>
                    </div>
                </div>
                
                <!-- CTA Box -->
                <div class="mt-6 p-4 bg-gradient-to-r from-orange-50 to-amber-50 border border-orange-100 rounded-xl">
                    <div class="flex gap-3">
                        <i class="fas fa-arrow-right text-orange-500 mt-0.5"></i>
                        <div class="flex-1">
                            <p class="text-sm font-semibold text-orange-900 mb-1">Ready to Get Started?</p>
                            <p class="text-sm text-orange-700">
                                Click <span class="font-bold">Contacts</span> in the sidebar (highlighted) to start adding your contacts and watch your dashboard come to life!
                            </p>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Footer -->
            <div class="px-6 py-4 bg-slate-50 border-t border-slate-100 flex items-center justify-between">
                <label class="flex items-center gap-2 cursor-pointer">
                    <input type="checkbox" id="dontShowAgainDashboard" class="rounded border-slate-300 text-orange-500 focus:ring-orange-500">
                    <span class="text-sm text-slate-600">Don't show this again</span>
                </label>
                <button onclick="closeDashboardOnboarding()" class="px-6 py-2.5 bg-gradient-to-r from-orange-500 to-orange-600 text-white font-semibold rounded-lg hover:from-orange-600 hover:to-orange-700 shadow-lg shadow-orange-500/25 transition-all">
                    Let's Go!
                </button>
            </div>
        </div>
    </div>
</div>

<style>
@keyframes fade-in-up {
    from {
        opacity: 0;
        transform: translateY(20px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

.animate-fade-in-up {
    animation: fade-in-up 0.4s ease-out;
}

@keyframes pulse-ring {
    0%, 100% {
        box-shadow: 0 0 0 0 rgba(249, 115, 22, 0.7);
    }
    50% {
        box-shadow: 0 0 0 12px rgba(249, 115, 22, 0);
    }
}

#contactsLinkSpotlight {
    animation: pulse-ring 2s infinite;
}
</style>

<script>
let hasShownDashboardOnboarding = {{ 'true' if current_user.has_seen_dashboard_onboarding else 'false' }};

function positionContactsSpotlight() {
    // Find the contacts link in the sidebar
    const contactsLink = document.querySelector('a[href="{{ url_for(\'main.contacts\') }}"]');
    const spotlight = document.getElementById('contactsLinkSpotlight');
    
    if (contactsLink && spotlight) {
        const rect = contactsLink.getBoundingClientRect();
        spotlight.style.top = `${rect.top - 8}px`;
        spotlight.style.left = `${rect.left - 8}px`;
        spotlight.style.width = `${rect.width + 16}px`;
        spotlight.style.height = `${rect.height + 16}px`;
    }
}

function showDashboardOnboarding() {
    if (hasShownDashboardOnboarding) {
        return;
    }
    
    const overlay = document.getElementById('dashboardOnboarding');
    overlay.classList.remove('hidden');
    document.body.style.overflow = 'hidden';
    
    // Position spotlight after a brief delay to ensure layout is ready
    setTimeout(positionContactsSpotlight, 100);
    
    // Reposition on window resize
    window.addEventListener('resize', positionContactsSpotlight);
}

function closeDashboardOnboarding() {
    const dontShowAgain = document.getElementById('dontShowAgainDashboard').checked;
    const overlay = document.getElementById('dashboardOnboarding');
    
    overlay.classList.add('hidden');
    document.body.style.overflow = '';
    hasShownDashboardOnboarding = true;
    
    // Remove resize listener
    window.removeEventListener('resize', positionContactsSpotlight);
    
    if (dontShowAgain) {
        // Save preference to backend
        fetch('/dashboard/dismiss-onboarding', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            }
        }).catch(err => console.error('Failed to save onboarding preference:', err));
    }
}

// Show onboarding after page loads
window.addEventListener('load', function() {
    setTimeout(showDashboardOnboarding, 800);
});
</script>
